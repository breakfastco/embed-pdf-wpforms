!function(epdfWf,undefined){jQuery(document).ready((function(e){$builder=jQuery("#wpforms-builder"),$builder.on("wpformsFieldAdd",(function(event,id,type){"pdf_viewer"===type&&addPdfViewerFieldHandlers(event)})),$builder.on("wpformsBuilderReady",addPdfViewerFieldHandlers)}));const{__:__}=wp.i18n;function abortPreviousFetch(e){controller.abort()}function addPdfViewerFieldHandlers(event){var els=document.querySelectorAll(".wpforms-field-option-row-pdf_url button");els&&els.forEach((el=>{el.removeEventListener("click",handleChooseClick),el.addEventListener("click",handleChooseClick)})),(els=document.querySelectorAll(".wpforms-field-option-row-pdf_url input.pdf-url"))&&els.forEach((el=>{el.removeEventListener("input",abortPreviousFetch),el.addEventListener("input",abortPreviousFetch),el.removeEventListener("input",handleUrlInput),el.addEventListener("input",handleUrlInput),el.dispatchEvent(new Event("input"))}))}function wpformsSetFieldError(element,message){wpformsResetFieldError(element),element.classList.add("wpforms-error");const error=document.createElement("p");error.classList.add("wpforms-alert-danger"),error.classList.add("wpforms-alert"),error.classList.add("wpforms-error-msg"),error.innerHTML=message,element.parentNode.insertBefore(error,element.nextSibling)}function wpformsResetFieldError(element){element.classList.remove("wpforms-error"),document.querySelectorAll("#"+element.parentNode.id+" .wpforms-alert").forEach((el=>el.remove()))}function handleUrlInput(e){if(e.preventDefault(),""!==e.target.value)if(isValidHttpUrl(e.target.value)){if(epdf_wf_pdf_viewer_strings.site_url!==e.target.value.substring(0,epdf_wf_pdf_viewer_strings.site_url.length)){var msg=__("Only PDFs hosted by this website and other websites listing this website in a CORS header ‘Access-Control-Allow-Origin’ can load in the viewer.","embed-pdf-wpforms")+' <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS">'+__("Learn about CORS →","embed-pdf-wpforms")+"</a>";return epdf_wf_pdf_viewer_strings.can_upload_files&&(msg+=sprintf('<br /><br /><button id="download_pdf_media" class="wpforms-btn wpforms-btn-sm" data-field="%1$s">%2$s</button>',e.target.getAttribute("name").replaceAll(/[^0-9]+/g,""),__("Download PDF into Media Library","embed-pdf-wpforms"))),wpformsSetFieldError(e.target,msg),void(epdf_wf_pdf_viewer_strings.can_upload_files&&document.querySelector("#download_pdf_media").addEventListener("click",handleDownloadClick))}localFileExists(e.target.value).then((exists=>exists?wpformsResetFieldError(e.target):wpformsSetFieldError(e.target,__("No file exists at the provided URL.","embed-pdf-wpforms"))))}else wpformsSetFieldError(e.target,__("Please enter a valid URL.","embed-pdf-wpforms"));else wpformsResetFieldError(e.target)}function handleChooseClick(e){e.preventDefault();var file_frame=wp.media.frames.file_frame=wp.media({title:__("Choose PDF","embed-pdf-wpforms"),button:{text:__("Load","embed-pdf-wpforms")},frame:"select",multiple:!1});return file_frame.on("select",(function(){var attachment=file_frame.state().get("selection").first().toJSON(),urlEl=document.getElementById("wpforms-field-option-"+e.target.dataset.field+"-pdf_url");urlEl&&attachment.url&&(urlEl.value=attachment.url,urlEl.dispatchEvent(new Event("input")))})),file_frame.open(),!1}function handleDownloadClick(e){e.preventDefault(),field=e.target.dataset.field;var url=document.getElementById("wpforms-field-option-"+field+"-pdf_url").value;if(isValidHttpUrl(url))return fetch(epdf_wf_pdf_viewer_strings.ajax_url,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"epdf_wf_download_pdf_media",_ajax_nonce:epdf_wf_pdf_viewer_strings.nonce,url:url}).toString()}).then((response=>response.json())).then((responseObj=>{if(responseObj){var urlEl=document.getElementById("wpforms-field-option-"+field+"-pdf_url");responseObj.data.url&&isValidHttpUrl(responseObj.data.url??"")?(urlEl.value=responseObj.data.url,wpformsResetFieldError(urlEl)):!responseObj.success&&responseObj.data.msg&&wpformsSetFieldError(urlEl,responseObj.data.msg)}})).catch((error=>{console.error("[Embed PDF for WPForms] Download failed."),console.error(error)})),!1;setFieldError("pdf_url_setting","below",__("Please enter a valid URL.","embed-pdf-wpforms"))}function isValidHttpUrl(string){let url;try{url=new URL(string)}catch(_){return!1}return"http:"===url.protocol||"https:"===url.protocol}var controller=new AbortController;const localFileExists=file=>{if(epdf_wf_pdf_viewer_strings.site_url!==file.substring(0,epdf_wf_pdf_viewer_strings.site_url.length))return Promise.resolve(!1);controller=new AbortController;return fetch(file,{method:"HEAD",cache:"no-store",credentials:"omit",signal:controller.signal}).then((response=>200===response.status&&response.url===file)).catch((exception=>!1))}}(window.epdfWf=window.epdfWf||{});