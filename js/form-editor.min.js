function abortPreviousFetch(e){controller.abort()}function addPdfViewerFieldHandlers(event){var els=document.querySelectorAll(".wpforms-field-option-row-pdf_url button");els&&els.forEach((el=>{el.removeEventListener("click",handleChooseClick),el.addEventListener("click",handleChooseClick)})),(els=document.querySelectorAll(".wpforms-field-option-row-pdf_url input.pdf-url"))&&els.forEach((el=>{el.removeEventListener("input",abortPreviousFetch),el.addEventListener("input",abortPreviousFetch),el.removeEventListener("input",handleUrlInput),el.addEventListener("input",handleUrlInput),el.dispatchEvent(new Event("input"))}))}function wpformsSetFieldError(element,message){wpformsResetFieldError(element),element.classList.add("wpforms-error");const error=document.createElement("p");error.classList.add("wpforms-alert-danger"),error.classList.add("wpforms-alert"),error.classList.add("wpforms-error-msg"),error.innerHTML=message,element.parentNode.insertBefore(error,element.nextSibling)}function wpformsResetFieldError(element){element.classList.remove("wpforms-error"),document.querySelectorAll("#"+element.parentNode.id+" .wpforms-alert").forEach((el=>el.remove()))}function handleUrlInput(e){e.preventDefault();const{__:__}=wp.i18n;if(isValidHttpUrl(e.target.value)){if(epdf_wf_pdf_viewer_strings.site_url!==e.target.value.substring(0,epdf_wf_pdf_viewer_strings.site_url.length)){const msg=__("Only PDFs hosted by this website and other websites listing this website in a CORS header ‘Access-Control-Allow-Origin’ can load in the viewer.","embed-pdf-wpforms")+' <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS">'+__("Learn about CORS →","embed-pdf-wpforms")+"</a>";wpformsSetFieldError(e.target,msg)}}else wpformsSetFieldError(e.target,__("Please enter a valid URL.","embed-pdf-wpforms"));localFileExists(e.target.value).then((exists=>exists?wpformsResetFieldError(e.target):wpformsSetFieldError(e.target,__("No file exists at the provided URL.","embed-pdf-wpforms"))))}function handleChooseClick(e){e.preventDefault();const{__:__}=wp.i18n;var file_frame=wp.media.frames.file_frame=wp.media({title:__("Choose PDF","embed-pdf-wpforms"),button:{text:__("Load","embed-pdf-wpforms")},frame:"select",multiple:!1});return file_frame.on("select",(function(){var attachment=file_frame.state().get("selection").first().toJSON(),urlEl=document.getElementById("wpforms-field-option-"+e.target.dataset.fieldId+"-pdf_url");urlEl&&attachment.url&&(urlEl.value=attachment.url,urlEl.dispatchEvent(new Event("input")))})),file_frame.open(),!1}function isValidHttpUrl(string){let url;try{url=new URL(string)}catch(_){return!1}return"http:"===url.protocol||"https:"===url.protocol}jQuery(document).ready((function(e){$builder=jQuery("#wpforms-builder"),$builder.on("wpformsFieldAdd",(function(event,id,type){"pdf_viewer"===type&&addPdfViewerFieldHandlers(event)})),$builder.on("wpformsBuilderReady",addPdfViewerFieldHandlers)}));var controller=new AbortController;const localFileExists=file=>{if(epdf_wf_pdf_viewer_strings.site_url!==file.substring(0,epdf_wf_pdf_viewer_strings.site_url.length))return Promise.resolve(!1);controller=new AbortController;return fetch(file,{method:"HEAD",cache:"no-store",credentials:"omit",signal:controller.signal}).then((response=>200===response.status&&response.url===file)).catch((exception=>!1))};