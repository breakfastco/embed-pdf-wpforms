function handleChooseClick(e){e.preventDefault();const{__:__}=wp.i18n;var file_frame=wp.media.frames.file_frame=wp.media({title:__("Choose PDF","embed-pdf-gravityforms"),button:{text:__("Load","embed-pdf-gravityforms")},frame:"select",multiple:!1});return file_frame.on("select",(function(){var attachment=file_frame.state().get("selection").first().toJSON(),urlEl=document.getElementById("field_pdf_url");urlEl||(urlEl=document.getElementById("url_pdf")),urlEl&&attachment.url&&(urlEl.value=attachment.url,urlEl.dispatchEvent(new Event("input")))})),file_frame.open(),!1}function isValidHttpUrl(string){let url;try{url=new URL(string)}catch(_){return!1}return"http:"===url.protocol||"https:"===url.protocol}function renderPage(epgfInstance,pageNum){epgfInstance.pageRendering=!0,epgfInstance.pdfDoc.getPage(pageNum).then((function(page){var viewport=page.getViewport({scale:epgfInstance.pdfDoc.currentScaleValue});epgfInstance.canvas.height=viewport.height,epgfInstance.canvas.width=viewport.width;var renderContext={canvasContext:epgfInstance.canvas.getContext("2d"),viewport:viewport},renderTask;page.render(renderContext).promise.then((function(){epgfInstance.pageRendering=!1,null!==epgfInstance.pageNumPending&&(renderPage(epgfInstance,epgfInstance.pageNumPending),epgfInstance.pageNumPending=null),epgfInstance.canvas.style.width="100%",epgfInstance.canvas.style.width=epgfInstance.canvas.width+"px";const event=new CustomEvent("epgf_render_page",{detail:epgfInstance.pageNum});window.dispatchEvent(event)}))})),document.getElementById(epgfInstance.canvasId+"_page_num").textContent=pageNum}function queueRenderPage(epgfInstance){epgfInstance.pageRendering?epgfInstance.pageNumPending=epgfInstance.pageNum:renderPage(epgfInstance,epgfInstance.pageNum)}function onPrevPage(e){var epgfInstance=window["epgf_"+e.target.dataset.viewerId];epgfInstance.pageNum<=1||(epgfInstance.pageNum--,queueRenderPage(epgfInstance),togglePrevNextButtons(epgfInstance))}function onNextPage(e){var epgfInstance=window["epgf_"+e.target.dataset.viewerId];epgfInstance.pageNum>=epgfInstance.pdfDoc.numPages||(epgfInstance.pageNum++,queueRenderPage(epgfInstance),togglePrevNextButtons(epgfInstance))}function togglePrevNextButtons(epgfInstance){document.getElementById(epgfInstance.canvasId+"_prev").disabled=1==epgfInstance.pageNum,document.getElementById(epgfInstance.canvasId+"_next").disabled=epgfInstance.pageNum==epgfInstance.pdfDoc.numPages}function scaleDeltaDefault(){return 1.1}function scaleMin(){return.25}function scaleMax(){return 10}function onZoomIn(e){var epgfInstance=window["epgf_"+e.target.dataset.viewerId];let newScale=epgfInstance.pdfDoc.currentScaleValue;newScale=(newScale*scaleDeltaDefault()).toFixed(2),newScale=Math.ceil(10*newScale)/10,newScale=Math.min(scaleMax(),newScale),epgfInstance.pdfDoc.currentScaleValue=newScale,renderPage(epgfInstance,epgfInstance.pageNum);const event=new CustomEvent("epgf_scale_value",{detail:newScale});window.dispatchEvent(event)}function onZoomOut(e){var epgfInstance=window["epgf_"+e.target.dataset.viewerId];let newScale=epgfInstance.pdfDoc.currentScaleValue;newScale=(newScale/scaleDeltaDefault()).toFixed(2),newScale=Math.floor(10*newScale)/10,newScale=Math.max(scaleMin(),newScale),epgfInstance.pdfDoc.currentScaleValue=newScale,renderPage(epgfInstance,epgfInstance.pageNum);const event=new CustomEvent("epgf_scale_value",{detail:newScale});window.dispatchEvent(event)}function loadPreview(fieldId,formId){var epgfInstance=window["epgf_"+fieldId],fieldElementId="field_"+formId+"_"+fieldId;""!==epgfInstance.urlPdf&&pdfjsLib.getDocument({url:epgfInstance.urlPdf,verbosity:0}).promise.then((function(pdfDoc_){epgfInstance.pdfDoc&&epgfInstance.pdfDoc.destroy(),epgfInstance.pdfDoc=pdfDoc_,document.getElementById(epgfInstance.canvasId+"_page_count").textContent=epgfInstance.pdfDoc.numPages,epgfInstance.pdfDoc.currentScaleValue=epgfInstance.initialScale,epgfInstance.canvas.style.width="100%",renderPage(epgfInstance,epgfInstance.pageNum),togglePrevNextButtons(epgfInstance)})).catch((function(error){console.log(error);const el=document.querySelector("#"+fieldElementId+" .ginput_container_pdf_viewer");if(el&&error.message){const{__:__}=wp.i18n;var msg="<p><b>"+__("PDF Viewer Error:","embed-pdf-gravityforms")+"</b> "+error.message;epgf_pdfjs_strings.is_user_logged_in&&(msg+=' <a href="https://breakfastco.xyz/embed-pdf-for-gravity-forms/#troubleshooting">'+__("Troubleshooting →","embed-pdf-gravityforms")+"</a>"),msg+="</p>",el.innerHTML+=msg}const controlEls=document.querySelectorAll("#"+fieldElementId+" .epgf-controls-container, #"+fieldElementId+" .epgf-container").forEach((function(el){el.style.display="none"}))}))}jQuery(document).on("wpformsReady",event=>{jQuery(".wpforms-field-pdf_viewer").each(field=>{var textSettings={field_initial_scale:"initialScale",field_pdf_url:"pdfUrl"};Object.keys(textSettings).forEach(key=>{var el=document.getElementById(key);el&&(el.value=field[0][textSettings[key]],["input","propertychange"].forEach((function(e){el.addEventListener(e,(function(){if(SetFieldProperty(textSettings[key],this.value),"field_pdf_url"===key){if(""===this.value)return void resetFieldError("pdf_url_setting");if(isValidHttpUrl(this.value))if(epgf_pdf_viewer_strings.site_url!==this.value.substring(0,epgf_pdf_viewer_strings.site_url.length)){const{__:__}=wp.i18n;setFieldError("pdf_url_setting","below",__("Only PDFs hosted by this website and other websites listing this website in a CORS header ‘Access-Control-Allow-Origin’ can load in the viewer.","embed-pdf-gravityforms")+'<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS">'+__("Learn about CORS →","embed-pdf-gravityforms")+"</a>")}else resetFieldError("pdf_url_setting");else{const{__:__}=wp.i18n;setFieldError("pdf_url_setting","below",__("Please enter a valid URL.","embed-pdf-gravityforms"))}}}))})),el.dispatchEvent(new Event("input")))}),el=document.getElementById("choose_pdf_url"),el&&(el.removeEventListener("click",handleChooseClick),el.addEventListener("click",handleChooseClick))})}),window.addEventListener("load",(function(e){"undefined"!=typeof pdfjsLib&&(pdfjsLib.GlobalWorkerOptions.workerSrc=epgf_pdfjs_strings.url_worker)}));