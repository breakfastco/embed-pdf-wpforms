function addPdfViewerFieldHandlers(event){var els=document.querySelectorAll(".wpforms-field-option-row-pdf_url button");els&&els.forEach((el=>{el.removeEventListener("click",handleChooseClick),el.addEventListener("click",handleChooseClick)})),(els=document.querySelectorAll(".wpforms-field-option-row-pdf_url input.pdf-url"))&&els.forEach((el=>{el.removeEventListener("input",handleUrlInput),el.addEventListener("input",handleUrlInput),el.dispatchEvent(new Event("input"))}))}function wpformsSetFieldError(element,message){wpformsResetFieldError(element),element.classList.add("wpforms-error");const error=document.createElement("p");error.classList.add("wpforms-alert-danger"),error.classList.add("wpforms-alert"),error.classList.add("wpforms-error-msg"),error.innerHTML=message,element.parentNode.insertBefore(error,element.nextSibling)}function wpformsResetFieldError(element){element.classList.remove("wpforms-error"),document.querySelectorAll("#"+element.parentNode.id+" .wpforms-alert").forEach((el=>el.remove()))}function handleUrlInput(e){if(e.preventDefault(),isValidHttpUrl(e.target.value))if(epdf_wf_pdf_viewer_strings.site_url!==e.target.value.substring(0,epdf_wf_pdf_viewer_strings.site_url.length)){const{__:__}=wp.i18n,msg=__("Only PDFs hosted by this website and other websites listing this website in a CORS header ‘Access-Control-Allow-Origin’ can load in the viewer.","embed-pdf-wpforms")+' <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS">'+__("Learn about CORS →","embed-pdf-wpforms")+"</a>";wpformsSetFieldError(e.target,msg)}else wpformsResetFieldError(e.target);else{const{__:__}=wp.i18n;wpformsSetFieldError(e.target,__("Please enter a valid URL.","embed-pdf-wpforms"))}}function handleChooseClick(e){e.preventDefault();const{__:__}=wp.i18n;var file_frame=wp.media.frames.file_frame=wp.media({title:__("Choose PDF","embed-pdf-wpforms"),button:{text:__("Load","embed-pdf-wpforms")},frame:"select",multiple:!1});return file_frame.on("select",(function(){var attachment=file_frame.state().get("selection").first().toJSON(),urlEl=document.getElementById("wpforms-field-option-"+e.target.dataset.fieldId+"-pdf_url");urlEl&&attachment.url&&(urlEl.value=attachment.url,urlEl.dispatchEvent(new Event("input")))})),file_frame.open(),!1}function isValidHttpUrl(string){let url;try{url=new URL(string)}catch(_){return!1}return"http:"===url.protocol||"https:"===url.protocol}function renderPage(epdfInstance,pageNum){epdfInstance.pageRendering=!0,epdfInstance.pdfDoc.getPage(pageNum).then((function(page){var viewport=page.getViewport({scale:epdfInstance.pdfDoc.currentScaleValue});epdfInstance.canvas.height=viewport.height,epdfInstance.canvas.width=viewport.width;var renderContext={canvasContext:epdfInstance.canvas.getContext("2d"),viewport:viewport};page.render(renderContext).promise.then((function(){epdfInstance.pageRendering=!1,null!==epdfInstance.pageNumPending&&(renderPage(epdfInstance,epdfInstance.pageNumPending),epdfInstance.pageNumPending=null),epdfInstance.canvas.style.width="100%",epdfInstance.canvas.style.width=epdfInstance.canvas.width+"px";const event=new CustomEvent("epdf_render_page",{detail:epdfInstance.pageNum});window.dispatchEvent(event)}))})),document.getElementById(epdfInstance.canvasId+"_page_num").textContent=pageNum}function queueRenderPage(epdfInstance){epdfInstance.pageRendering?epdfInstance.pageNumPending=epdfInstance.pageNum:renderPage(epdfInstance,epdfInstance.pageNum)}function onPrevPage(e){var epdfInstance=window["epdf_"+e.target.dataset.viewerId];epdfInstance.pageNum<=1||(epdfInstance.pageNum--,queueRenderPage(epdfInstance),togglePrevNextButtons(epdfInstance))}function onNextPage(e){var epdfInstance=window["epdf_"+e.target.dataset.viewerId];epdfInstance.pageNum>=epdfInstance.pdfDoc.numPages||(epdfInstance.pageNum++,queueRenderPage(epdfInstance),togglePrevNextButtons(epdfInstance))}function togglePrevNextButtons(epdfInstance){document.getElementById(epdfInstance.canvasId+"_prev").disabled=1==epdfInstance.pageNum,document.getElementById(epdfInstance.canvasId+"_next").disabled=epdfInstance.pageNum==epdfInstance.pdfDoc.numPages}function scaleDeltaDefault(){return 1.1}function scaleMin(){return.25}function scaleMax(){return 10}function onZoomIn(e){var epdfInstance=window["epdf_"+e.target.dataset.viewerId];let newScale=epdfInstance.pdfDoc.currentScaleValue;newScale=(newScale*scaleDeltaDefault()).toFixed(2),newScale=Math.ceil(10*newScale)/10,newScale=Math.min(scaleMax(),newScale),epdfInstance.pdfDoc.currentScaleValue=newScale,renderPage(epdfInstance,epdfInstance.pageNum);const event=new CustomEvent("epdf_scale_value",{detail:newScale});window.dispatchEvent(event)}function onZoomOut(e){var epdfInstance=window["epdf_"+e.target.dataset.viewerId];let newScale=epdfInstance.pdfDoc.currentScaleValue;newScale=(newScale/scaleDeltaDefault()).toFixed(2),newScale=Math.floor(10*newScale)/10,newScale=Math.max(scaleMin(),newScale),epdfInstance.pdfDoc.currentScaleValue=newScale,renderPage(epdfInstance,epdfInstance.pageNum);const event=new CustomEvent("epdf_scale_value",{detail:newScale});window.dispatchEvent(event)}function loadPreview(fieldId,formId){var epdfInstance=window["epdf_"+fieldId];if(void 0===epdfInstance)return void(epdf_wf_pdf_viewer_strings.script_debug&&console.log("[Embed PDF for WPForms] loadPreview( "+fieldId+" ) failed, spin up data missing"));if(""===epdfInstance.urlPdf)return void(epdf_wf_pdf_viewer_strings.script_debug&&console.log("[Embed PDF for WPForms] loadPreview( "+fieldId+" ) failed, no PDF URL"));const controls={prev:"onPrevPage",next:"onNextPage",zoom_in:"onZoomIn",zoom_out:"onZoomOut"};Object.keys(controls).forEach((function(key,index){var el=document.getElementById(epdfInstance.canvasId+"_"+key);el&&el.addEventListener("click",window[controls[key]])})),pdfjsLib.getDocument({url:epdfInstance.urlPdf,verbosity:0}).promise.then((function(pdfDoc_){epdfInstance.pdfDoc&&epdfInstance.pdfDoc.destroy(),epdfInstance.pdfDoc=pdfDoc_,document.getElementById(epdfInstance.canvasId+"_page_count").textContent=epdfInstance.pdfDoc.numPages,epdfInstance.pdfDoc.currentScaleValue=epdfInstance.initialScale,epdfInstance.canvas.style.width="100%",renderPage(epdfInstance,epdfInstance.pageNum),togglePrevNextButtons(epdfInstance)})).catch((function(error){epdf_wf_pdf_viewer_strings.script_debug&&(console.log("[Embed PDF for WPForms]"),console.log(error));const el=document.querySelector("#wpforms-"+formId+"-field_"+fieldId+".wpforms-container-pdf-viewer");if(el&&error.message){const{__:__}=wp.i18n;var msg="<p><b>"+__("PDF Viewer Error:","embed-pdf-wpforms")+"</b> "+error.message;epdf_wf_pdfjs_strings.is_user_logged_in&&(msg+=' <a href="https://breakfastco.xyz/embed-pdf-for-wpforms/#troubleshooting">'+__("Troubleshooting →","embed-pdf-wpforms")+"</a>"),msg+="</p>",el.innerHTML+=msg}el.querySelectorAll(".epdf-controls-container, .epdf-container").forEach((function(el){el.style.display="none"}))}))}jQuery(document).ready((function(e){$builder=jQuery("#wpforms-builder"),$builder.on("wpformsFieldAdd",(function(event,id,type){"pdf_viewer"===type&&addPdfViewerFieldHandlers(event)})),$builder.on("wpformsBuilderReady",addPdfViewerFieldHandlers)})),window.addEventListener("load",(function(e){if("undefined"!=typeof pdfjsLib){pdfjsLib.GlobalWorkerOptions.workerSrc=epdf_wf_pdfjs_strings.url_worker;const event=new CustomEvent("epdf_pdfjs_worker_set");window.dispatchEvent(event)}}));